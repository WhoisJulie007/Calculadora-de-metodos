<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Métodos Numéricos</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>

    <style>
        /* Estilos generales */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5; color: #1c1e21; margin: 0; display: flex;
            justify-content: center; align-items: flex-start; min-height: 100vh; padding: 20px; box-sizing: border-box;
        }
        .container {
            width: 100%; max-width: 900px; background-color: #ffffff; border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding: 2rem; box-sizing: border-box;
        }
        header { text-align: center; border-bottom: 1px solid #e0e0e0; padding-bottom: 1rem; margin-bottom: 1.5rem; }
        h1, h2, h3, h4 { color: #0052cc; }
        h2, h3 { text-align: center; margin-bottom: 1.5rem; }
        h4 { margin-top: 2rem; border-bottom: 2px solid #007bff; padding-bottom: 0.5rem; }
        .btn {
            display: block; width: 100%; padding: 12px 20px; margin: 10px 0; font-size: 16px; font-weight: 600;
            color: #ffffff; background-color: #007bff; border: none; border-radius: 8px; cursor: pointer;
            text-align: center; text-decoration: none; transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .btn:hover { background-color: #0056b3; }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background-color: #a1a1a1; cursor: not-allowed; }
        .btn-secondary { background-color: #6c757d; }
        .btn-secondary:hover { background-color: #5a6268; }
        .input-group { display: flex; flex-direction: column; margin-bottom: 1rem; }
        .input-group label { margin-bottom: 5px; font-weight: 500; color: #495057; }
        .input-group input, .input-group select {
            padding: 10px; border: 1px solid #ced4da; border-radius: 6px; font-size: 16px; width: 100%; box-sizing: border-box;
        }
        .input-row { display: flex; gap: 10px; }
        .input-table {
            width: 100%; max-width: 450px; margin: 0 auto 1.5rem auto; border-collapse: collapse;
        }
        .input-table th { font-size: 1.1em; font-weight: 600; padding: 12px; text-align: center; color: #0052cc; }
        .input-table td { padding: 6px; }
        .input-table input {
            width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 6px;
            font-size: 16px; box-sizing: border-box; text-align: center;
        }
        .results-container { margin-top: 2rem; padding: 1.5rem; background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; }
        .results-container p b { color: #343a40; }
        .equation {
            font-family: "Courier New", Courier, monospace; background-color: #e9ecef; padding: 15px; border-radius: 4px;
            word-wrap: break-word; margin: 10px 0; line-height: 1.6; font-size: 1.1em; overflow-x: auto;
        }
        .results-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; font-size: 0.9em; }
        .results-table th, .results-table td { border: 1px solid #dee2e6; padding: 8px; text-align: center; }
        .results-table th { background-color: #e9ecef; font-weight: 600; }
        .evaluation-section { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; margin-top: 1.5rem; }
        .evaluation-section input { width: 100%; }
        .evaluation-section .btn { width: auto; margin: 0; }
        .matrix-display { display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; }
        .matrix-display table { border: 2px solid #333; border-collapse: collapse; }
        .matrix-display td { padding: 8px 12px; text-align: center; border: 1px solid #ccc; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <header><h1>Métodos Numéricos</h1></header>
        <main id="content"></main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    let currentChart = null;
    const content = document.getElementById('content');
    
    // --- NAVEGACIÓN Y HELPERS ---
    const switchView = (viewFunction) => {
        if (currentChart) { currentChart.destroy(); currentChart = null; }
        content.innerHTML = ''; // Limpiar contenido antes de cargar la nueva vista
        viewFunction();
    };

    const addBackButton = () => {
        const backButton = document.createElement('button');
        backButton.className = 'btn btn-secondary';
        backButton.textContent = 'Regresar al Menú';
        backButton.addEventListener('click', () => switchView(showMainMenu));
        content.appendChild(backButton);
    };

    const showMainMenu = () => {
        content.innerHTML = `
            <h2>Selecciona un Método</h2>
            <h3>Interpolación</h3>
            <button class="btn" id="btn-simple">Interpolación Simple (Lineal)</button>
            <button class="btn" id="btn-quad">Interpolación Cuadrática (Newton)</button>
            <button class="btn" id="btn-lagrange-lin">Lagrange Lineal</button>
            <button class="btn" id="btn-lagrange-quad">Lagrange Cuadrática</button>
            <button class="btn" id="btn-newton">Newton - Diferencias Divididas</button>
            <h3>Regresión y Raíces</h3>
            <button class="btn" id="btn-ls">Mínimos Cuadrados</button>
            <button class="btn" id="btn-nr">Raíces: Newton-Raphson</button>
            <button class="btn" id="btn-secant">Raíces: Secantes</button>
        `;
        document.getElementById('btn-simple').addEventListener('click', () => switchView(showSimpleInterpolation));
        document.getElementById('btn-quad').addEventListener('click', () => switchView(showQuadratic));
        document.getElementById('btn-lagrange-lin').addEventListener('click', () => switchView(showLagrangeLinear));
        document.getElementById('btn-lagrange-quad').addEventListener('click', () => switchView(showLagrangeQuadratic));
        document.getElementById('btn-newton').addEventListener('click', () => switchView(showNewton));
        document.getElementById('btn-ls').addEventListener('click', () => switchView(showLeastSquares));
        document.getElementById('btn-nr').addEventListener('click', () => switchView(showNewtonRaphson));
        document.getElementById('btn-secant').addEventListener('click', () => switchView(showSecantMethod));
    };

    // --- INTERPOLACIÓN SIMPLE (LINEAL) ---
    const showSimpleInterpolation = () => {
        content.innerHTML = `<h2>Interpolación Simple (Lineal)</h2><table class="input-table"><thead><tr><th>X</th><th>Y (f(x))</th></tr></thead><tbody><tr><td><input type="number" id="s-x0" placeholder="x₀"></td><td><input type="number" id="s-y0" placeholder="f(x₀)"></td></tr><tr><td><input type="number" id="s-x1" placeholder="x₁"></td><td><input type="number" id="s-y1" placeholder="f(x₁)"></td></tr></tbody></table><button class="btn" id="calculate-simple">Calcular</button><div id="simple-results" class="results-container hidden"></div>`;
        addBackButton();
        document.getElementById('calculate-simple').addEventListener('click', calculateSimpleInterpolation);
    };
    const calculateSimpleInterpolation = () => {
        try {
            const x0 = parseFloat(document.getElementById('s-x0').value); const y0 = parseFloat(document.getElementById('s-y0').value);
            const x1 = parseFloat(document.getElementById('s-x1').value); const y1 = parseFloat(document.getElementById('s-y1').value);
            if ([x0, y0, x1, y1].some(isNaN)) throw new Error("Todos los campos deben ser números válidos.");
            if (x0 === x1) throw new Error("Los valores de 'x' deben ser distintos.");
            const slope = (y1 - y0) / (x1 - x0);
            const polyFunc = x => y0 + slope * (x - x0);
            const resultsContainer = document.getElementById('simple-results');
            resultsContainer.classList.remove('hidden');
            resultsContainer.innerHTML = `<h3>Resultados</h3><p><b>Ecuación General:</b></p><div class="equation">f₁(x) = f(x₀) + ( (f(x₁) - f(x₀)) / (x₁ - x₀) ) * (x - x₀)</div><p><b>Ecuación Sustituida:</b></p><div class="equation">f₁(x) = ${y0.toFixed(4)} + ( (${y1} - ${y0}) / (${x1} - ${x0}) ) * (x - ${x0})</div><p><b>Ecuación Simplificada:</b></p><div class="equation">f₁(x) = ${y0.toFixed(4)} + ${slope.toFixed(4)}(x - ${x0})</div><h3>Evaluar</h3><div class="evaluation-section"><input type="number" id="eval-x" placeholder="Valor de x"><button class="btn" id="eval-btn">Evaluar</button></div><div id="eval-equation" class="equation hidden"></div><p id="eval-result" style="text-align:center; color:#28a745; font-weight:bold;"></p><h3>Gráfica</h3><canvas id="chart"></canvas>`;
            document.getElementById('eval-btn').addEventListener('click', () => {
                const xVal = parseFloat(document.getElementById('eval-x').value);
                if (!isNaN(xVal)) {
                    const yVal = polyFunc(xVal);
                    document.getElementById('eval-equation').innerHTML = `f₁(${xVal}) = ${y0.toFixed(4)} + ${slope.toFixed(4)}(${xVal} - ${x0})`;
                    document.getElementById('eval-equation').classList.remove('hidden');
                    document.getElementById('eval-result').innerText = `Valor Aproximado f₁(${xVal}) ≈ ${yVal.toFixed(4)}`;
                }
            });
            plotChart([x0, x1], [y0, y1], polyFunc);
        } catch (e) { alert(`Error: ${e.message}`); }
    };
    
    // --- INTERPOLACIÓN CUADRÁTICA (FORMA NEWTON) ---
    const showQuadratic = () => {
        content.innerHTML = `<h2>Interpolación Cuadrática (Forma Newton)</h2><p style="text-align:center;">Este método utiliza la fórmula de Newton para 3 puntos.</p><table class="input-table"><thead><tr><th>X</th><th>Y</th></tr></thead><tbody><tr><td><input type="number" id="q-x0" placeholder="x₀"></td><td><input type="number" id="q-y0" placeholder="y₀"></td></tr><tr><td><input type="number" id="q-x1" placeholder="x₁"></td><td><input type="number" id="q-y1" placeholder="y₁"></td></tr><tr><td><input type="number" id="q-x2" placeholder="x₂"></td><td><input type="number" id="q-y2" placeholder="y₂"></td></tr></tbody></table><button class="btn" id="calculate-quadratic">Calcular</button><div id="quadratic-results" class="results-container hidden"></div>`;
        addBackButton();
        document.getElementById('calculate-quadratic').addEventListener('click', calculateQuadratic);
    };
    const calculateQuadratic = () => {
        try {
            const pointsX = [parseFloat(document.getElementById('q-x0').value), parseFloat(document.getElementById('q-x1').value), parseFloat(document.getElementById('q-x2').value)];
            const pointsY = [parseFloat(document.getElementById('q-y0').value), parseFloat(document.getElementById('q-y1').value), parseFloat(document.getElementById('q-y2').value)];
            if (pointsX.some(isNaN) || pointsY.some(isNaN)) throw new Error("Todos los campos deben ser números válidos.");
            if (new Set(pointsX).size !== 3) throw new Error("Los valores de 'x' deben ser distintos.");
            const [x0, x1, x2] = pointsX; const [y0, y1, y2] = pointsY;
            const b0 = y0; const b1 = (y1 - y0) / (x1 - x0); const b2 = (((y2 - y1) / (x2 - x1)) - b1) / (x2 - x0);
            const resultsContainer = document.getElementById('quadratic-results');
            resultsContainer.classList.remove('hidden');
            const polyFunc = x => b0 + b1 * (x - x0) + b2 * (x - x0) * (x - x1);
            resultsContainer.innerHTML = `<h3>Resultados</h3><p><b>Coeficientes (Betas):</b></p><div class="equation">b₀ = ${b0.toFixed(4)}<br>b₁ = ${b1.toFixed(4)}<br>b₂ = ${b2.toFixed(4)}</div><p><b>Ecuación General:</b></p><div class="equation">f₂(x) = b₀ + b₁(x - x₀) + b₂(x - x₀)(x - x₁)</div><p><b>Ecuación Sustituida:</b></p><div class="equation">f₂(x) = ${b0.toFixed(4)} + (${b1.toFixed(4)})(x - ${x0}) + (${b2.toFixed(4)})(x - ${x0})(x - ${x1})</div><h3>Evaluar</h3><div class="evaluation-section"><input type="number" id="eval-x" placeholder="Valor de x"><button class="btn" id="eval-btn">Evaluar</button></div><div id="eval-equation" class="equation hidden"></div><p id="eval-result" style="text-align:center; color:#28a745; font-weight:bold;"></p><h3>Gráfica</h3><canvas id="chart"></canvas>`;
            document.getElementById('eval-btn').addEventListener('click', () => {
                const xVal = parseFloat(document.getElementById('eval-x').value);
                if (!isNaN(xVal)) {
                    const yVal = polyFunc(xVal);
                    const substitutedEq = `f₂(${xVal}) = ${b0.toFixed(4)} + (${b1.toFixed(4)})(${xVal} - ${x0}) + (${b2.toFixed(4)})(${xVal} - ${x0})(${xVal} - ${x1})`;
                    document.getElementById('eval-equation').innerHTML = substitutedEq;
                    document.getElementById('eval-equation').classList.remove('hidden');
                    document.getElementById('eval-result').innerText = `Valor Aproximado f₂(${xVal}) ≈ ${yVal.toFixed(4)}`;
                }
            });
            plotChart(pointsX, pointsY, polyFunc);
        } catch (e) { alert(`Error: ${e.message}`); }
    };
    
    // --- LAGRANGE LINEAL ---
    const showLagrangeLinear = () => {
        content.innerHTML = `<h2>Interpolación de Lagrange (Lineal)</h2><table class="input-table"><thead><tr><th>X</th><th>Y (f(x))</th></tr></thead><tbody><tr><td><input type="number" id="ll-x0" placeholder="x₀"></td><td><input type="number" id="ll-y0" placeholder="f(x₀)"></td></tr><tr><td><input type="number" id="ll-x1" placeholder="x₁"></td><td><input type="number" id="ll-y1" placeholder="f(x₁)"></td></tr></tbody></table><button class="btn" id="calculate-ll">Calcular</button><div id="ll-results" class="results-container hidden"></div>`;
        addBackButton();
        document.getElementById('calculate-ll').addEventListener('click', calculateLagrangeLinear);
    };
    const calculateLagrangeLinear = () => {
        try {
            const x0 = parseFloat(document.getElementById('ll-x0').value); const y0 = parseFloat(document.getElementById('ll-y0').value);
            const x1 = parseFloat(document.getElementById('ll-x1').value); const y1 = parseFloat(document.getElementById('ll-y1').value);
            if ([x0, y0, x1, y1].some(isNaN)) throw new Error("Todos los campos deben ser números válidos.");
            if (x0 === x1) throw new Error("Los valores de 'x' deben ser distintos.");
            const polyFunc = x => ((x - x1) / (x0 - x1)) * y0 + ((x - x0) / (x1 - x0)) * y1;
            const resultsContainer = document.getElementById('ll-results');
            resultsContainer.classList.remove('hidden');
            resultsContainer.innerHTML = `<h3>Resultados</h3><p><b>Ecuación General (Lagrange, Grado 1):</b></p><div class="equation">P₁(x) = ((x - x₁)/(x₀ - x₁))f(x₀) + ((x - x₀)/(x₁ - x₀))f(x₁)</div><p><b>Ecuación Sustituida:</b></p><div class="equation">P₁(x) = ((x - ${x1})/(${x0} - ${x1}))(${y0}) + ((x - ${x0})/(${x1} - ${x0}))(${y1})</div><h3>Evaluar</h3><div class="evaluation-section"><input type="number" id="eval-x" placeholder="Valor de x"><button class="btn" id="eval-btn">Evaluar</button></div><div id="eval-equation" class="equation hidden"></div><p id="eval-result" style="text-align:center; color:#28a745; font-weight:bold;"></p><h3>Gráfica</h3><canvas id="chart"></canvas>`;
            document.getElementById('eval-btn').addEventListener('click', () => {
                const xVal = parseFloat(document.getElementById('eval-x').value);
                if (!isNaN(xVal)) {
                    const yVal = polyFunc(xVal);
                    document.getElementById('eval-equation').innerHTML = `P₁(${xVal}) = ((${xVal} - ${x1})/(${x0} - ${x1}))(${y0}) + ((${xVal} - ${x0})/(${x1} - ${x0}))(${y1})`;
                    document.getElementById('eval-equation').classList.remove('hidden');
                    document.getElementById('eval-result').innerText = `Valor Aproximado P₁(${xVal}) ≈ ${yVal.toFixed(4)}`;
                }
            });
            plotChart([x0, x1], [y0, y1], polyFunc);
        } catch (e) { alert(`Error: ${e.message}`); }
    };
    
    // --- LAGRANGE CUADRÁTICA ---
    const showLagrangeQuadratic = () => {
        content.innerHTML = `<h2>Interpolación de Lagrange (Cuadrática)</h2><table class="input-table"><thead><tr><th>X</th><th>Y (f(x))</th></tr></thead><tbody><tr><td><input type="number" id="lq-x0" placeholder="x₀"></td><td><input type="number" id="lq-y0" placeholder="f(x₀)"></td></tr><tr><td><input type="number" id="lq-x1" placeholder="x₁"></td><td><input type="number" id="lq-y1" placeholder="f(x₁)"></td></tr><tr><td><input type="number" id="lq-x2" placeholder="x₂"></td><td><input type="number" id="lq-y2" placeholder="f(x₂)"></td></tr></tbody></table><button class="btn" id="calculate-lq">Calcular</button><div id="lq-results" class="results-container hidden"></div>`;
        addBackButton();
        document.getElementById('calculate-lq').addEventListener('click', calculateLagrangeQuadratic);
    };
    const calculateLagrangeQuadratic = () => {
        try {
            const pointsX = [parseFloat(document.getElementById('lq-x0').value), parseFloat(document.getElementById('lq-x1').value), parseFloat(document.getElementById('lq-x2').value)];
            const pointsY = [parseFloat(document.getElementById('lq-y0').value), parseFloat(document.getElementById('lq-y1').value), parseFloat(document.getElementById('lq-y2').value)];
            if (pointsX.some(isNaN) || pointsY.some(isNaN)) throw new Error("Todos los campos deben ser números válidos.");
            if (new Set(pointsX).size !== 3) throw new Error("Los valores de 'x' deben ser distintos.");
            const [x0, x1, x2] = pointsX; const [y0, y1, y2] = pointsY;
            const polyFunc = x => {
                const L0 = ((x - x1) * (x - x2)) / ((x0 - x1) * (x0 - x2));
                const L1 = ((x - x0) * (x - x2)) / ((x1 - x0) * (x1 - x2));
                const L2 = ((x - x0) * (x - x1)) / ((x2 - x0) * (x2 - x1));
                return y0 * L0 + y1 * L1 + y2 * L2;
            };
            const resultsContainer = document.getElementById('lq-results');
            resultsContainer.classList.remove('hidden');
            resultsContainer.innerHTML = `<h3>Resultados</h3><p><b>Ecuación General (Lagrange, Grado 2):</b></p><div class="equation" style="font-size: 0.9em;">P₂(x) = ((x-x₁)(x-x₂))/((x₀-x₁)(x₀-x₂))f(x₀) +<br>((x-x₀)(x-x₂))/((x₁-x₀)(x₁-x₂))f(x₁) +<br>((x-x₀)(x-x₁))/((x₂-x₀)(x₂-x₁))f(x₂)</div><p><b>Ecuación Sustituida:</b></p><div class="equation" style="font-size: 0.9em;">P₂(x) = ((x-${x1})(x-${x2}))/((${x0}-${x1})(${x0}-${x2}))(${y0}) +<br>((x-${x0})(x-${x2}))/((${x1}-${x0})(${x1}-${x2}))(${y1}) +<br>((x-${x0})(x-${x1}))/((${x2}-${x0})(${x2}-${x1}))(${y2})</div><h3>Evaluar</h3><div class="evaluation-section"><input type="number" id="eval-x" placeholder="Valor de x"><button class="btn" id="eval-btn">Evaluar</button></div><div id="eval-equation" class="equation hidden"></div><p id="eval-result" style="text-align:center; color:#28a745; font-weight:bold;"></p><h3>Gráfica</h3><canvas id="chart"></canvas>`;
            document.getElementById('eval-btn').addEventListener('click', () => {
                const xVal = parseFloat(document.getElementById('eval-x').value);
                if (!isNaN(xVal)) {
                    document.getElementById('eval-result').innerText = `Valor Aproximado P₂(${xVal}) ≈ ${polyFunc(xVal).toFixed(4)}`;
                }
            });
            plotChart(pointsX, pointsY, polyFunc);
        } catch (e) { alert(`Error: ${e.message}`); }
    };

    // --- NEWTON DIFERENCIAS DIVIDIDAS ---
    const showNewton = () => {
        content.innerHTML = `<h2>Newton – Diferencias Divididas</h2><div class="input-group" style="max-width: 450px; margin: auto;"><label for="newton-degree">Selecciona el grado del polinomio:</label><select id="newton-degree"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option><option value="5">5</option></select></div><div id="newton-inputs"></div><button class="btn" id="calculate-newton">Calcular</button><div id="newton-results" class="results-container hidden"></div>`;
        addBackButton();
        const degreeSelector = document.getElementById('newton-degree');
        degreeSelector.addEventListener('change', () => createNewtonInputs(degreeSelector.value));
        createNewtonInputs(degreeSelector.value);
        document.getElementById('calculate-newton').addEventListener('click', calculateNewton);
    };
    const createNewtonInputs = (degree) => {
        const nPoints = parseInt(degree) + 1;
        const inputsContainer = document.getElementById('newton-inputs');
        let tableHTML = `<h3>Puntos (x, y) - Se requieren ${nPoints} puntos</h3><table class="input-table"><thead><tr><th>X</th><th>Y</th></tr></thead><tbody>`;
        for (let i = 0; i < nPoints; i++) {
            tableHTML += `<tr><td><input type="number" class="newton-x" placeholder="x${i}"></td><td><input type="number" class="newton-y" placeholder="y${i} (f(x${i}))"></td></tr>`;
        }
        tableHTML += `</tbody></table>`;
        inputsContainer.innerHTML = tableHTML;
    };
    const calculateNewton = () => {
        try {
            const pointsX = Array.from(document.getElementsByClassName('newton-x')).map(el => parseFloat(el.value));
            const pointsY = Array.from(document.getElementsByClassName('newton-y')).map(el => parseFloat(el.value));
            if (pointsX.some(isNaN) || pointsY.some(isNaN)) throw new Error("Todos los campos de puntos deben ser números válidos.");
            if (new Set(pointsX).size !== pointsX.length) throw new Error("Los valores de 'x' deben ser distintos.");
            const n = pointsX.length;
            const diffTable = Array(n).fill(0).map(() => Array(n).fill(0));
            pointsY.forEach((y, i) => diffTable[i][0] = y);
            for (let j = 1; j < n; j++) {
                for (let i = 0; i < n - j; i++) {
                    diffTable[i][j] = (diffTable[i + 1][j - 1] - diffTable[i][j - 1]) / (pointsX[i + j] - pointsX[i]);
                }
            }
            const polyCoeffs = diffTable[0];
            const polyFunc = (x) => {
                let result = polyCoeffs[0];
                for (let i = 1; i < n; i++) {
                    let term = polyCoeffs[i];
                    for (let j = 0; j < i; j++) { term *= (x - pointsX[j]); }
                    result += term;
                }
                return result;
            };
            let polyString = `${polyCoeffs[0].toFixed(4)}`;
            for (let i = 1; i < polyCoeffs.length; i++) {
                if (polyCoeffs[i] === 0) continue;
                const sign = polyCoeffs[i] > 0 ? ' + ' : ' - ';
                let termString = `${Math.abs(polyCoeffs[i]).toFixed(4)}`;
                for (let j = 0; j < i; j++) { termString += `(x - ${pointsX[j]})`; }
                polyString += sign + termString;
            }
            
            const resultsContainer = document.getElementById('newton-results');
            resultsContainer.classList.remove('hidden');
            resultsContainer.innerHTML = `<h3>Tabla de Diferencias Divididas</h3><table class="results-table"><thead><tr><th>X</th><th>f(X)</th>${Array.from({length: n-1}, (_, i) => `<th>Orden ${i+1}</th>`).join('')}</tr></thead><tbody>${pointsX.map((px, i) => `<tr><td>${px}</td>${diffTable[i].map((val, j) => i <= n-1-j ? `<td>${val.toFixed(5)}</td>` : '').join('')}</tr>`).join('')}</tbody></table><p><b>Coeficientes (Betas):</b></p><div class="equation">${polyCoeffs.map((b, i) => `b${i} = ${b.toFixed(5)}`).join('<br>')}</div><p><b>Polinomio de Newton:</b></p><div class="equation">${polyString}</div><h3>Evaluar</h3><div class="evaluation-section"><input type="number" id="eval-x" placeholder="Valor de x"><button class="btn" id="eval-btn">Evaluar</button></div><p id="eval-result" style="text-align:center; color:#28a745; font-weight:bold;"></p><h3>Gráfica</h3><canvas id="chart"></canvas>`;
            document.getElementById('eval-btn').addEventListener('click', () => {
                const xVal = parseFloat(document.getElementById('eval-x').value);
                if (!isNaN(xVal)) {
                    document.getElementById('eval-result').innerText = `Valor Aproximado P(${xVal}) ≈ ${polyFunc(xVal).toFixed(4)}`;
                }
            });
            plotChart(pointsX, pointsY, polyFunc);
        } catch (e) { alert(`Error: ${e.message}`); }
    };

    // --- MÍNIMOS CUADRADOS ---
    const showLeastSquares = () => {
        content.innerHTML = `<h2>Mínimos Cuadrados</h2><div class="input-group" style="max-width: 300px; margin: auto;"><label for="ls-n-points">¿Cuántos puntos (x, y) existen?</label><input type="number" id="ls-n-points" min="3" placeholder="Ej: 9"></div><button class="btn" id="ls-generate-inputs" style="max-width: 300px; margin: 1rem auto;">Generar Campos</button><div id="ls-inputs-container"></div><div id="ls-results" class="results-container hidden"></div>`;
        addBackButton();
        document.getElementById('ls-generate-inputs').addEventListener('click', createLeastSquaresInputs);
    };
    const createLeastSquaresInputs = () => {
        const n = parseInt(document.getElementById('ls-n-points').value);
        if (isNaN(n) || n < 3) { alert("Por favor, introduce un número de puntos válido (mínimo 3)."); return; }
        const container = document.getElementById('ls-inputs-container');
        let tableHTML = `<table class="input-table"><thead><tr><th>X</th><th>Y (f(x))</th></tr></thead><tbody>`;
        for (let i = 0; i < n; i++) {
            tableHTML += `<tr><td><input type="number" class="ls-x" placeholder="x${i+1}"></td><td><input type="number" class="ls-y" placeholder="y${i+1}"></td></tr>`;
        }
        tableHTML += `</tbody></table><button class="btn" id="ls-calculate">Calcular</button>`;
        container.innerHTML = tableHTML;
        document.getElementById('ls-calculate').addEventListener('click', calculateLeastSquares);
    };
    const calculateLeastSquares = () => {
        try {
            const inputsX = document.getElementsByClassName('ls-x'); const inputsY = document.getElementsByClassName('ls-y');
            const points = [];
            for (let i = 0; i < inputsX.length; i++) {
                const x = parseFloat(inputsX[i].value); const y = parseFloat(inputsY[i].value);
                if (isNaN(x) || isNaN(y)) throw new Error(`Dato inválido en el punto ${i+1}.`);
                points.push({ x, y });
            }
            if (points.length < 3) throw new Error("Se necesitan al menos 3 puntos.");
            const n = points.length;
            const sum = { x: 0, y: 0, x2: 0, x3: 0, x4: 0, xy: 0, x2y: 0 };
            points.forEach(p => { sum.x += p.x; sum.y += p.y; sum.x2 += p.x**2; sum.x3 += p.x**3; sum.x4 += p.x**4; sum.xy += p.x * p.y; sum.x2y += (p.x**2) * p.y; });
            const y_mean = sum.y / n;
            let SST = 0;
            points.forEach(p => { SST += (p.y - y_mean)**2; });
            const A_lin = math.matrix([[n, sum.x], [sum.x, sum.x2]]); const b_lin = math.matrix([sum.y, sum.xy]);
            const A_inv_lin = math.inv(A_lin); const coeffs_lin = math.multiply(A_inv_lin, b_lin).toArray();
            const [a0_lin, a1_lin] = coeffs_lin;
            const f_lin = x => a0_lin + a1_lin * x;
            let SSE_lin = 0; points.forEach(p => { SSE_lin += (p.y - f_lin(p.x))**2; });
            const R2_lin = 1 - (SSE_lin / SST);
            const A_quad = math.matrix([[n, sum.x, sum.x2], [sum.x, sum.x2, sum.x3], [sum.x2, sum.x3, sum.x4]]);
            const b_quad = math.matrix([sum.y, sum.xy, sum.x2y]);
            const A_inv_quad = math.inv(A_quad); const coeffs_quad = math.multiply(A_inv_quad, b_quad).toArray();
            const [a0_quad, a1_quad, a2_quad] = coeffs_quad;
            const f_quad = x => a0_quad + a1_quad * x + a2_quad * x**2;
            let SSE_quad = 0; points.forEach(p => { SSE_quad += (p.y - f_quad(p.x))**2; });
            const R2_quad = 1 - (SSE_quad / SST);
            const resultsContainer = document.getElementById('ls-results');
            resultsContainer.classList.remove('hidden');
            resultsContainer.innerHTML = `<h3>Tabla de Sumatorias</h3><table class="results-table"><thead><tr><th>Σx</th><th>Σy</th><th>Σx²</th><th>Σx³</th><th>Σx⁴</th><th>Σxy</th><th>Σx²y</th></tr></thead><tbody><tr><td>${sum.x.toFixed(4)}</td><td>${sum.y.toFixed(4)}</td><td>${sum.x2.toFixed(4)}</td><td>${sum.x3.toFixed(4)}</td><td>${sum.x4.toFixed(4)}</td><td>${sum.xy.toFixed(4)}</td><td>${sum.x2y.toFixed(4)}</td></tr></tbody></table><h4>A. Ecuación Lineal</h4><div class="matrix-display"><div><b>Matriz A</b><br>${matrixToHTML(A_lin.toArray())}</div><div><b>Vector b</b><br>${matrixToHTML(b_lin.toArray().map(v => [v]))}</div><div><b>Matriz Inversa A⁻¹</b><br>${matrixToHTML(A_inv_lin.toArray())}</div></div><p><b>Coeficientes:</b></p><div class="equation">a₀ = ${a0_lin.toFixed(6)}<br>a₁ = ${a1_lin.toFixed(6)}</div><p><b>Ecuación:</b></p><div class="equation">y = ${a0_lin.toFixed(4)} + ${a1_lin.toFixed(4)}x</div><p><b>Coeficiente de Determinación (R²):</b></p><div class="equation">R² = ${R2_lin.toFixed(6)}</div><div class="evaluation-section"><input type="number" id="eval-lin-x" placeholder="Evaluar en x"><button class="btn" id="eval-lin-btn">Evaluar</button></div><div id="eval-lin-eq" class="equation hidden"></div><p id="eval-lin-result" style="text-align:left; color:#28a745; font-weight:bold;"></p><h4>B. Ecuación Cuadrática</h4><div class="matrix-display"><div><b>Matriz A</b><br>${matrixToHTML(A_quad.toArray())}</div><div><b>Vector b</b><br>${matrixToHTML(b_quad.toArray().map(v => [v]))}</div><div><b>Matriz Inversa A⁻¹</b><br>${matrixToHTML(A_inv_quad.toArray())}</div></div><p><b>Coeficientes:</b></p><div class="equation">a₀ = ${a0_quad.toFixed(6)}<br>a₁ = ${a1_quad.toFixed(6)}<br>a₂ = ${a2_quad.toFixed(6)}</div><p><b>Ecuación:</b></p><div class="equation">y = ${a0_quad.toFixed(4)} + ${a1_quad.toFixed(4)}x + ${a2_quad.toFixed(4)}x²</div><p><b>Coeficiente de Determinación (R²):</b></p><div class="equation">R² = ${R2_quad.toFixed(6)}</div><div class="evaluation-section"><input type="number" id="eval-quad-x" placeholder="Evaluar en x"><button class="btn" id="eval-quad-btn">Evaluar</button></div><div id="eval-quad-eq" class="equation hidden"></div><p id="eval-quad-result" style="text-align:left; color:#28a745; font-weight:bold;"></p><h3>Gráfica Comparativa</h3><canvas id="chart"></canvas>`;
            document.getElementById('eval-lin-btn').addEventListener('click', () => {
                const x = parseFloat(document.getElementById('eval-lin-x').value); if(isNaN(x)) return;
                document.getElementById('eval-lin-eq').innerHTML = `y = ${a0_lin.toFixed(4)} + ${a1_lin.toFixed(4)}(${x})`;
                document.getElementById('eval-lin-eq').classList.remove('hidden');
                document.getElementById('eval-lin-result').innerText = `Resultado: y ≈ ${f_lin(x).toFixed(4)}`;
            });
            document.getElementById('eval-quad-btn').addEventListener('click', () => {
                const x = parseFloat(document.getElementById('eval-quad-x').value); if(isNaN(x)) return;
                document.getElementById('eval-quad-eq').innerHTML = `y = ${a0_quad.toFixed(4)} + ${a1_quad.toFixed(4)}(${x}) + ${a2_quad.toFixed(4)}(${x})²`;
                document.getElementById('eval-quad-eq').classList.remove('hidden');
                document.getElementById('eval-quad-result').innerText = `Resultado: y ≈ ${f_quad(x).toFixed(4)}`;
            });
            plotLeastSquares(points, f_lin, f_quad);
        } catch (e) { alert(`Error: ${e.message}`); }
    };

    // --- NEWTON-RAPHSON ---
    const showNewtonRaphson = () => {
        content.innerHTML = `<h2>Raíces: Método de Newton-Raphson</h2><div id="nr-workflow"><div id="nr-step1"><h4>Paso 1: Ingresa la Ecuación</h4><div class="input-group"><label for="nr-eq">Escribe la función f(x):</label><input type="text" id="nr-eq" placeholder="Ej: 2*x^3 - 11.7*x^2 + 17.7*x - 5"></div><button class="btn" id="nr-process-eq">Procesar Ecuación</button></div><div id="nr-step2-container"></div><div id="nr-step3-container"></div><div id="nr-step4-container"></div></div>`;
        addBackButton();
        document.getElementById('nr-process-eq').addEventListener('click', () => {
            document.getElementById('nr-step2-container').innerHTML = ''; document.getElementById('nr-step3-container').innerHTML = ''; document.getElementById('nr-step4-container').innerHTML = '';
            if (currentChart) { currentChart.destroy(); currentChart = null; }
            try {
                const eqStr = document.getElementById('nr-eq').value;
                if (!eqStr) throw new Error("La ecuación no puede estar vacía.");
                const node = math.parse(eqStr); const derivNode = math.derivative(node, 'x'); const simplifiedDeriv = math.simplify(derivNode);
                const func = node.compile(); const funcDeriv = simplifiedDeriv.compile();
                const derivString = simplifiedDeriv.toString({ fraction: 'decimal', implicit: 'hide' });
                const step2Container = document.getElementById('nr-step2-container');
                step2Container.innerHTML = `<div id="nr-step2"><h4>Paso 2: Graficar para Estimar una Raíz</h4><p>Tu función y su derivada simplificada son:</p><div class="equation">f(x) = ${node.toString({implicit: 'hide'})}</div><div class="equation">f'(x) = ${derivString}</div><p>Ingresa un rango para graficar f(x).</p><div class="input-row"><input type="number" id="nr-range-min" placeholder="Valor X Mínimo"><input type="number" id="nr-range-max" placeholder="Valor X Máximo"></div><button class="btn" id="nr-plot">Graficar</button></div>`;
                document.getElementById('nr-plot').addEventListener('click', () => {
                    document.getElementById('nr-step3-container').innerHTML = ''; document.getElementById('nr-step4-container').innerHTML = '';
                    const min = parseFloat(document.getElementById('nr-range-min').value); const max = parseFloat(document.getElementById('nr-range-max').value);
                    if (isNaN(min) || isNaN(max) || min >= max) { alert("Ingresa un rango válido."); return; }
                    const step3Container = document.getElementById('nr-step3-container');
                    step3Container.innerHTML = `<div id="nr-step3"><canvas id="chart"></canvas><h4>Paso 3: Realizar Iteraciones</h4><p>Observa la gráfica y elige un valor inicial (x₀) cercano a una raíz.</p><div class="input-row"><input type="number" id="nr-x0" placeholder="Valor inicial x₀"><input type="number" id="nr-iterations" placeholder="Nº de iteraciones"></div><button class="btn" id="nr-calculate">Calcular Tabla</button></div>`;
                    const xValues = [], yValues = []; const step = (max - min) / 200;
                    for (let x = min; x <= max; x += step) { xValues.push(x.toFixed(4)); yValues.push(func.evaluate({ x })); }
                    if (currentChart) { currentChart.destroy(); }
                    currentChart = new Chart(document.getElementById('chart').getContext('2d'), { type: 'line', data: { labels: xValues, datasets: [{ label: `f(x) = ${eqStr}`, data: yValues, borderColor: '#007bff', fill: false, borderWidth: 2, pointRadius: 0 }] }, options: { scales: { y: { beginAtZero: false }, x: { ticks: { maxTicksLimit: 10 } } } } });
                    document.getElementById('nr-calculate').addEventListener('click', () => {
                        document.getElementById('nr-step4-container').innerHTML = '';
                        const x0 = parseFloat(document.getElementById('nr-x0').value); const iter = parseInt(document.getElementById('nr-iterations').value);
                        if (isNaN(x0) || isNaN(iter) || iter <= 0) { alert("Ingresa un valor inicial y un número de iteraciones válidos."); return; }
                        let tableData = [], xn = x0, firstZeroFound = false;
                        for (let i = 1; i <= iter; i++) {
                            const fxn = func.evaluate({ x: xn }); const fpxn = funcDeriv.evaluate({ x: xn });
                            if (Math.abs(fpxn) < 1e-12) { alert("La derivada se hizo cero. El método no puede continuar."); break; }
                            const xn1 = xn - (fxn / fpxn);
                            const ea = (xn1 !== 0) ? Math.abs((xn1 - xn) / xn1) * 100 : 0;
                            let highlight = false;
                            if (ea < 1e-7 && !firstZeroFound) { highlight = true; firstZeroFound = true; }
                            tableData.push({ i, xn, fxn, fpxn, xn1, ea, highlight });
                            xn = xn1;
                        }
                        const finalRoot = tableData.length > 0 ? tableData[tableData.length - 1].xn1 : NaN;
                        const step4Container = document.getElementById('nr-step4-container');
                        step4Container.innerHTML = `<div id="nr-results" class="results-container"><h4>Paso 4: Resultados</h4><table class="results-table"><thead><tr><th>i</th><th>Xn</th><th>f(xn)</th><th>f'(xn)</th><th>xn+1</th><th>Ea (%)</th></tr></thead><tbody>${tableData.map(row => `<tr ${row.highlight ? 'style="background-color: #d4edda;"' : ''}><td>${row.i}</td><td>${row.xn.toFixed(8)}</td><td>${row.fxn.toExponential(4)}</td><td>${row.fpxn.toFixed(8)}</td><td>${row.xn1.toFixed(8)}</td><td>${row.ea.toFixed(8)}</td></tr>`).join('')}</tbody></table><h4>Verificación Final</h4><div class="evaluation-section"><input type="number" id="nr-verify-x" value="${finalRoot.toFixed(8)}"><button class="btn" id="nr-verify-btn">Verificar</button></div><div id="nr-verify-eq" class="equation hidden"></div><div id="nr-verify-result" style="font-weight: bold; text-align: center;"></div></div>`;
                        document.getElementById('nr-verify-btn').addEventListener('click', () => {
                            const x_root = parseFloat(document.getElementById('nr-verify-x').value); if(isNaN(x_root)) return;
                            const final_result = func.evaluate({x: x_root});
                            document.getElementById('nr-verify-eq').innerText = node.toString().replace(/x/g, `(${x_root})`);
                            document.getElementById('nr-verify-eq').classList.remove('hidden');
                            document.getElementById('nr-verify-result').innerText = `f(${x_root}) ≈ ${final_result.toExponential(4)}`;
                        });
                    });
                });
            } catch (e) { alert(`Error procesando la función: ${e.message}\n\nSugerencia: Intenta escribir la ecuación sin paréntesis innecesarios. Por ejemplo: 2*x^3 - 11.7*x^2 + 17.7*x - 5`); }
        });
    };

    // --- MÉTODO DE LA SECANTE ---
    const showSecantMethod = () => {
        content.innerHTML = `<h2>Raíces: Método de la Secante</h2><div id="sec-workflow"><div id="sec-step1"><h4>Paso 1: Ingresa la Ecuación y Grafica</h4><div class="input-group"><label for="sec-eq">Escribe la función f(x):</label><input type="text" id="sec-eq" placeholder="Ej: exp(-x) - x"></div><div class="input-row"><input type="number" id="sec-range-min" placeholder="Valor X Mínimo"><input type="number" id="sec-range-max" placeholder="Valor X Máximo"></div><button class="btn" id="sec-plot">Graficar</button></div><div id="sec-step2-container"></div><div id="sec-step3-container"></div></div>`;
        addBackButton();
        document.getElementById('sec-plot').addEventListener('click', () => {
            document.getElementById('sec-step2-container').innerHTML = ''; document.getElementById('sec-step3-container').innerHTML = '';
            if (currentChart) { currentChart.destroy(); currentChart = null; }
            try {
                const eqStr = document.getElementById('sec-eq').value;
                if (!eqStr) throw new Error("La ecuación no puede estar vacía.");
                const node = math.parse(eqStr); const func = node.compile();
                const min = parseFloat(document.getElementById('sec-range-min').value);
                const max = parseFloat(document.getElementById('sec-range-max').value);
                if (isNaN(min) || isNaN(max) || min >= max) { alert("Ingresa un rango válido."); return; }
                const step2Container = document.getElementById('sec-step2-container');
                step2Container.innerHTML = `<div id="sec-step2"><canvas id="chart"></canvas><h4>Paso 2: Ingresa Parámetros</h4><p>Observa la gráfica y elige dos valores iniciales cercanos a una raíz.</p><div class="input-row"><input type="number" id="sec-xi-1" placeholder="Valor inicial xᵢ₋₁"><input type="number" id="sec-xi" placeholder="Valor inicial xᵢ"></div><div class="input-row"><input type="number" id="sec-tol" placeholder="Tolerancia (ej: 0.001)"><input type="number" id="sec-max-iter" placeholder="Nº de Iteraciones"></div><button class="btn" id="sec-calculate">Calcular Tabla</button></div>`;
                const xValues = [], yValues = []; const step = (max - min) / 200;
                for (let x = min; x <= max; x += step) {
                    xValues.push(x.toFixed(4));
                    yValues.push(func.evaluate({ x }));
                }
                currentChart = new Chart(document.getElementById('chart').getContext('2d'), { type: 'line', data: { labels: xValues, datasets: [{ label: `f(x) = ${eqStr}`, data: yValues, borderColor: '#007bff', fill: false, borderWidth: 2, pointRadius: 0 }] }, options: { scales: { y: { beginAtZero: false }, x: { ticks: { maxTicksLimit: 10 } } } } });
                document.getElementById('sec-calculate').addEventListener('click', () => {
                    document.getElementById('sec-step3-container').innerHTML = '';
                    try {
                        let xi_1 = parseFloat(document.getElementById('sec-xi-1').value); let xi = parseFloat(document.getElementById('sec-xi').value);
                        const tol = parseFloat(document.getElementById('sec-tol').value); const maxIter = parseInt(document.getElementById('sec-max-iter').value);
                        if ([xi_1, xi, tol, maxIter].some(isNaN)) throw new Error("Todos los parámetros deben ser números válidos.");
                        let tableData = [], convergenceReached = false;
                        for (let i = 0; i < maxIter; i++) {
                            const fxi_1 = func.evaluate({ x: xi_1 }); const fxi = func.evaluate({ x: xi });
                            let xi_p1, error;
                            if (Math.abs(fxi - fxi_1) < 1e-12) {
                                xi_p1 = NaN; error = NaN;
                            } else {
                                xi_p1 = xi - fxi * (xi - xi_1) / (fxi - fxi_1);
                                error = (xi_p1 !== 0) ? Math.abs((xi_p1 - xi) / xi_p1) * 100 : 0;
                            }
                            let highlight = false;
                            if (typeof error === 'number' && error < tol && !convergenceReached) {
                                convergenceReached = true; highlight = true;
                            }
                            tableData.push({ iteracion: i + 1, xi_1, xi, fxi_1, fxi, xi_p1, error, highlight });
                            xi_1 = xi;
                            if (typeof xi_p1 === 'number') { xi = xi_p1; }
                        }
                        if (tableData.length === 0) throw new Error("No se pudo generar ninguna iteración.");
                        const finalRoot = tableData.filter(r => typeof r.xi_p1 === 'number').pop()?.xi_p1 ?? NaN;
                        const step3Container = document.getElementById('sec-step3-container');
                        step3Container.innerHTML = `<div id="sec-results" class="results-container"><h4>Resultados</h4><table class="results-table"><thead><tr><th>Iteración</th><th>xᵢ₋₁</th><th>xᵢ</th><th>f(xᵢ₋₁)</th><th>f(xᵢ)</th><th>xᵢ₊₁</th><th>Ea (%)</th></tr></thead><tbody>${tableData.map(row => `<tr ${row.highlight ? 'style="background-color: #FFF3CD;"' : ''}><td>${row.iteracion}</td><td>${row.xi_1.toFixed(6)}</td><td>${row.xi.toFixed(6)}</td><td>${row.fxi_1.toExponential(4)}</td><td>${row.fxi.toExponential(4)}</td><td>${typeof row.xi_p1 === 'number' ? row.xi_p1.toFixed(6) : '#DIV/0!'}</td><td>${typeof row.error === 'number' ? row.error.toFixed(6) : '#DIV/0!'}</td></tr>`).join('')}</tbody></table><h4>Verificación Final</h4><div class="evaluation-section"><input type="number" id="sec-verify-x" value="${isNaN(finalRoot) ? '' : finalRoot.toFixed(8)}"><button class="btn" id="sec-verify-btn">Verificar</button></div><div id="sec-verify-eq" class="equation hidden"></div><div id="sec-verify-result" style="font-weight: bold; text-align: center;"></div></div>`;
                        document.getElementById('sec-verify-btn').addEventListener('click', () => {
                            const x_root = parseFloat(document.getElementById('sec-verify-x').value); if(isNaN(x_root)) return;
                            const final_result = func.evaluate({x: x_root});
                            document.getElementById('sec-verify-eq').innerText = node.toString().replace(/x/g, `(${x_root})`);
                            document.getElementById('sec-verify-eq').classList.remove('hidden');
                            document.getElementById('sec-verify-result').innerText = `f(${x_root}) ≈ ${final_result.toExponential(4)}`;
                        });
                    } catch (e) { alert(`Error en el cálculo: ${e.message}`); }
                });
            } catch (e) { alert(`Error procesando la función: ${e.message}`); }
        });
    };
    
    // --- PLOTTERS Y HELPERS ADICIONALES ---
    const plotChart = (pointsX, pointsY, polyFunc) => {
        const canvas = document.getElementById('chart'); if (!canvas) return;
        const ctx = canvas.getContext('2d'); if (currentChart) { currentChart.destroy(); }
        const scatterData = pointsX.map((x, i) => ({ x, y: pointsY[i] }));
        const minX = Math.min(...pointsX); const maxX = Math.max(...pointsX);
        const range = maxX - minX; const lineData = []; const steps = 100;
        const startX = range === 0 ? minX - 1 : minX - range * 0.2;
        const endX = range === 0 ? maxX + 1 : maxX + range * 0.2;
        const stepSize = (endX - startX) / steps;
        for (let i = 0; i <= steps; i++) {
            const x = startX + i * stepSize;
            lineData.push({ x, y: polyFunc(x) });
        }
        currentChart = new Chart(ctx, {
            type: 'scatter',
            data: { datasets: [ { label: 'Polinomio', data: lineData, type: 'line', borderColor: '#007bff', fill: false, borderWidth: 2, pointRadius: 0 }, { label: 'Puntos', data: scatterData, backgroundColor: '#dc3545', pointRadius: 6 } ] },
            options: { responsive: true, scales: { x: { type: 'linear', position: 'bottom' }, y: {} } }
        });
    };
    const plotLeastSquares = (points, f_lin, f_quad) => {
        const canvas = document.getElementById('chart'); if (!canvas) return;
        const ctx = canvas.getContext('2d'); if (currentChart) { currentChart.destroy(); }
        const scatterData = points.map(p => ({ x: p.x, y: p.y }));
        const minX = Math.min(...points.map(p => p.x)); const maxX = Math.max(...points.map(p => p.x));
        const range = maxX - minX;
        const startX = minX - range * 0.1; const endX = maxX + range * 0.1;
        const lineData_lin = []; const lineData_quad = [];
        for (let x = startX; x <= endX; x += (endX - startX) / 100) {
            lineData_lin.push({ x, y: f_lin(x) });
            lineData_quad.push({ x, y: f_quad(x) });
        }
        currentChart = new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [
                    { label: 'Puntos Originales', data: scatterData, backgroundColor: '#000000' },
                    { label: 'Regresión Lineal', data: lineData_lin, type: 'line', borderColor: '#dc3545', fill: false, borderWidth: 2, pointRadius: 0 },
                    { label: 'Regresión Cuadrática', data: lineData_quad, type: 'line', borderColor: '#007bff', fill: false, borderWidth: 2, pointRadius: 0 }
                ]
            },
            options: { responsive: true, scales: { x: { type: 'linear', position: 'bottom' }, y: {} } }
        });
    };
    const matrixToHTML = (matrixArray) => {
        let html = '<table>';
        matrixArray.forEach(row => {
            html += '<tr>';
            row.forEach(cell => { html += `<td>${cell.toFixed(6)}</td>`; });
            html += '</tr>';
        });
        return html + '</table>';
    };

    // Iniciar la aplicación
    showMainMenu();
});
</script>

</body>
</html>